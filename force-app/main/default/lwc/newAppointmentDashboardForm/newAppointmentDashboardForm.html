<template>
    <!-- Contact Search View -->
    <template if:true={showSearchView}>
        <lightning-card title="Search Vehicles by Contact">
            <div class="slds-p-around_medium">
                <lightning-input
                    name="contact"
                    label="Enter Contact Number"
                    value={searchContact}
                    onchange={handleContactChange}
                    placeholder="Enter owner phone number">
                </lightning-input>

                <div class="slds-m-top_small">
                    <lightning-button
                        label="Search"
                        variant="brand"
                        onclick={handleContactSearch}
                        disabled={isSearchDisabled}>
                    </lightning-button>
                </div>

                <template if:true={isLoading}>
                    <div class="slds-m-top_medium slds-align_absolute-center">
                        <lightning-spinner alternative-text="Searching" size="small"></lightning-spinner>
                    </div>
                </template>

                <!-- Vehicles found -->
                <template if:true={vehiclesList}>
                    <div class="slds-m-top_medium">
                        <lightning-combobox
                            name="vehicleSelect"
                            label="Select Vehicle (VRN / VIN)"
                            options={vehicleOptions}
                            value={selectedVehicleId}
                            placeholder="Select a vehicle"
                            onchange={handleVehicleSelect}>
                        </lightning-combobox>
                    </div>

                    <div class="slds-m-top_small">
                        <lightning-button
                            label="Continue"
                            variant="brand"
                            onclick={handleSelectVehicleContinue}
                            disabled={isContinueDisabled}>
                        </lightning-button>
                    </div>
                </template>

                <template if:true={searchMade}>
                    <template if:false={hasVehicles}>
                        <div class="slds-m-top_medium slds-text-color_error">
                            No vehicles found for this contact number.
                        </div>
                    </template>
                </template>
            </div>
        </lightning-card>
    </template>

    <!-- Main Appointment Form -->
    <template if:true={showForm}>
        <lightning-card title="Book Appointment">
            <div class="slds-p-around_medium">
                <lightning-button
                    label="Back to Contact Search"
                    icon-name="utility:back"
                    variant="neutral"
                    onclick={handleBackToSearch}>
                </lightning-button>

                <!-- Dealer and Milestone Info in parallel -->
                <div class="slds-grid slds-gutters slds-m-top_medium">
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input
                            label="Dealer Name"
                            value={dealerName}
                            disabled>
                        </lightning-input>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input
                            label="Next Milestone Date"
                            value={milestoneDate}
                            disabled>
                        </lightning-input>
                    </div>
                </div>

                <!-- Vehicle Info -->
                <lightning-input label="Service Center" value={serviceCenterName} disabled></lightning-input>
                <lightning-input label="Vehicle Registration Number (VRN)" value={vrn} disabled></lightning-input>
                <template if:true={showVrnError}>
                    <div class="slds-text-color_error slds-m-top_small">
                        Vehicle Registration Number (VRN) not available for the selected vehicle.
                    </div>
                </template>
                <lightning-input label="Contact Number" value={contactNumber} disabled></lightning-input>
                <lightning-input label="Vehicle VIN" value={vin} disabled></lightning-input>

                <!-- VRN Missing Error -->
                

                <!-- Type of Service -->
                <lightning-combobox
                    class="slds-m-top_medium"
                    label="Type Of Requested Services"
                    value={selectedValue}
                    placeholder="Select an option"
                    options={options}
                    onchange={handleSelectServices}>
                </lightning-combobox>

                <!-- Appointment Date -->
                <lightning-input
                    type="date"
                    label="Appointment Date"
                    value={appointmentDate}
                    min={minDate}
                    onchange={handleDateChange}>
                </lightning-input>

                <!-- Available Slots -->
                <template if:true={slotsAvailable}>
                    <div class="slds-m-top_medium">
                        <lightning-combobox
                            label="Available Slot Items"
                            options={slotItemOptions}
                            value={selectedSlotItem}
                            onchange={handleSlotItemChange}>
                        </lightning-combobox>
                    </div>
                </template>

                <!-- Description -->
                <template if:true={showDescriptionField}>
                    <lightning-input
                        type="text"
                        class="slds-m-top_medium"
                        label="Appointment Description"
                        value={appointmentDecription}
                        onchange={handleAppointmentDesc}>
                    </lightning-input>
                </template>

                <!-- Spinner -->
                <template if:true={isLoading}>
                    <div class="slds-align_absolute-center slds-m-top_medium">
                        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                    </div>
                </template>

                <!-- Submit -->
                <div class="slds-m-top_medium slds-align_absolute-center">
                    <lightning-button
                        label="Submit"
                        variant="brand"
                        onclick={handleSubmit}
                        disabled={isSubmitDisabled}>
                    </lightning-button>
                </div>
            </div>
        </lightning-card>
    </template>
</template>