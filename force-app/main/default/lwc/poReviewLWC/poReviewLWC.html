<template>
    <lightning-card title="PO Review & Submission">

        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading"></lightning-spinner>
        </template>

        <template if:true={disableComponent}>
            <p class="slds-p-around_medium slds-text-color_error">
                This Purchase Order has already been submitted and cannot be modified.
            </p>
        </template>

        <template if:false={disableComponent}>

            <template if:false={isLoading}>
                <template if:true={lineItems.length}>
                    <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Forecast Quantity</th>
                                <!-- <th>Previously Forcasted</th> -->
                                <th style="text-align: center;">Requested Quantity</th>
                                <!--
                                <th>Approval Status</th>
                                -->
                                <th style="text-align: center;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={lineItems} for:item="item" for:index="index">
                                <tr key={item.Id}>
                                    <td>{item.ProductName}</td>
                                    <td>
                                        {item.ForecastQty}
                                    </td>
                                    <!--
                                    <td>
                                        <lightning-input style="text-align: center;"
                                            type="checkbox"
                                            checked={item.WasPreviouslyDeleted}
                                            disabled
                                            variant="label-hidden">
                                        </lightning-input>
                                    </td>
                                    -->
                                    <td>
                                        <lightning-input
                                            type="number"
                                            value={item.updatedQuantity}
                                            data-index={index}
                                            onchange={handleQuantityInputChange}>
                                        </lightning-input>
                                    </td>
                                    <!--
                                    <td>
                                        <lightning-combobox
                                            data-index={index}
                                            value={item.approvalStatus}
                                            options={statusOptions}
                                            onchange={handleStatusChange}>
                                        </lightning-combobox>
                                    </td>
                                    -->
                                    <td style="padding-top: 25px; text-align: center;">
                                        <lightning-button 
                                            label="Delete" 
                                            variant="destructive"
                                            data-index={index}
                                            data-id={item.Id}
                                            onclick={handleDelete}>
                                        </lightning-button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>

                    <br/>
                    <div class="slds-align_absolute-center">
                        <lightning-button label="Save" variant="brand" onclick={handleSave}></lightning-button>
                        <lightning-button label="Submit PO" variant="success" class="slds-m-left_small" onclick={handleSubmit}></lightning-button>
                    </div>
                </template>

                <template if:false={lineItems.length}>
                    <p class="slds-p-around_medium">No forecasted line items found.</p>
                </template>

                <hr class="slds-m-vertical_medium" />

                <div class="slds-m-top_medium slds-p-left_medium slds-p-right_medium" >
                    <h3 class="slds-text-heading_small">Add Product to PO</h3>
                    <lightning-combobox
                        name="productSelect"
                        label="Select Product"
                        placeholder="Select Product"
                        value={selectedProductId}
                        options={productOptions}
                        onchange={handleProductSelection}>
                    </lightning-combobox>

                    <lightning-input
                        name="newQty"
                        label="Quantity"
                        type="number"
                        value={newQty}
                        onchange={handleNewQtyChange}>
                    </lightning-input>

                    <div class="slds-align_absolute-center">
                        <lightning-button label="Add Line Item" 
                            variant="brand"
                            onclick={handleAddManualItem} 
                            class="slds-m-top_small">
                        </lightning-button>
                    </div>
                </div>
            </template>
        </template>

    </lightning-card>
</template>