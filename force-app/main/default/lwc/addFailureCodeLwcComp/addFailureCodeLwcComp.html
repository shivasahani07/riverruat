<template>
    <lightning-card title="Failure Code" icon-name="action:new_custom34" size="small">
        <!-- <lightning-button class="slds-m-left_small" label="+ Add" slot="actions" variant="brand" onclick={handleAddRow}>
        </lightning-button> -->
        <div class="slds-p-around_small">
            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                <thead>
                    <tr class="slds-text-title_caps">
                        <th>Failure Code</th>
                        <th>Batch Size</th>
                        <th>Active</th>
                        <th>Causal Product Code</th>
                        <th>VIN Cutoff</th>
                        <th>VIN Cutoff</th>
                        <th class="slds-align_absolute-center">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={failureCodes} for:item="row">
                        <tr key={row.id} class={row.rowClass}>
                            <td>
                                <lightning-input type="text" value={row.failureCode} data-id={row.id}
                                    data-field="failureCode" variant="label-hidden" required
                                    onchange={handleInputChange}>
                                </lightning-input>
                            </td>
                            <td>
                                <lightning-input type="number" value={row.batchSize} data-id={row.id}
                                    data-field="batchSize" variant="label-hidden" min="1" onchange={handleInputChange}>
                                </lightning-input>
                            </td>
                            <td>
                                <lightning-input type="checkbox" checked={row.active} data-id={row.id}
                                    data-field="active" variant="label-hidden" onchange={handleInputChange}>
                                </lightning-input>
                            </td>
                            <td>
                                <lightning-input type="text" value={row.causalProductCode} data-id={row.id}
                                    data-field="causalProductCode" variant="label-hidden" required
                                    onchange={handleInputChange}>
                                </lightning-input>
                            </td>
                            <td>
                                <!-- <lightning-input type="text" value={row.vinCutoff} data-id={row.id}
                                    data-field="vinCutoff" pattern="[A-Za-z0-9]{0}|[A-Za-z0-9]{17}"
                                    message-when-pattern-mismatch="VIN Cutoff must be empty or exactly 17 characters"
                                    maxlength="17" variant="label-hidden" onchange={handleInputChange}>
                                </lightning-input> -->
                            </td>
                            <td>
                                <lightning-input type="text" value={row.vinCutoff} data-id={row.id}
                                    data-field="vinCutoff" pattern="(^$)|^[A-HJ-NPR-Z0-9]{17}$"
                                    message-when-pattern-mismatch="VIN Cutoff must be empty or exactly 17 valid characters"
                                    maxlength="17" variant="label-hidden" onchange={handleInputChange}>
                                </lightning-input>

                            </td>
                            <td class="slds-align_absolute-center">
                                <lightning-button variant="destructive" icon-name="utility:delete" data-id={row.id}
                                    onclick={handleDeleteRow}>
                                </lightning-button>
                            </td>
                        </tr>
                    </template>

                </tbody>
            </table>

            <template if:true={hasDuplicates}>
                <div class="slds-m-top_small slds-notice slds-notice_warning">
                    <div class="slds-notice__content">
                        <span class="slds-icon_container slds-icon-utility-warning slds-m-right_x-small" title="Warning">
                            <lightning-icon icon-name="utility:warning" size="small"></lightning-icon>
                        </span>
                        <strong>Duplicate entries detected.</strong> Please resolve them before saving.
                    </div>
                </div>
            </template>

            <div class="slds-m-top_medium slds-align_absolute-center">
                <!-- <lightning-button label="Cancel" onclick={handleCancel}></lightning-button> -->
                <lightning-button class="slds-m-left_small" variant="brand" label="Save" onclick={handleSave}
                    disabled={hasDuplicates}>
                </lightning-button>
            </div>
        </div>
    </lightning-card>
</template>